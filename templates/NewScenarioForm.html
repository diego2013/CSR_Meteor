<!-- Main template for a Scenario -->
<template name="NewScenarioForm">
  <form id="newScenarioForm" class="new-scenario">
    <div class="main">
        {{> Template.dynamic template=newScenarioStep}}
    </div>



    <!--div here for control buttons -->
    <div id="controlButtons">
    	<!-- 
        <button type="submit" id="saveScenarioButton" name="saveButton" title="Save Scenario" value="Save">Save</button>
    	<button type="submit" id="submitScenarioButton" name="submitButton" title="Submit for approval" value="Submit" >Submit</button> 
        -->
        
        <input type="submit" id="saveScenarioButton" name="saveButton" title="Save the chages in this scenario" value="Save" />
        <button type="button" id="goToStep1" class="hiddenButton" name="none1" title="Go to the Basic Information panel" >Go back to basic information</button>
        <button type="button" id="goToStep2" name="none2" title="Go to the Advanced Information panel" >Add further details</button> 
        <button type="button" id="goToStep3" name="none3" title="Propose a solution for this scenario" >Propose a solution</button>
        <input type="submit" id="submitScenarioButton" name="submitButton" title="Submit for approval" value="Finish and Submit" />
        
        
        
    </div>
  </form>
</template>

<!-- Templates to move between the different scenario submission steps -->
<!-- ================================================================= -->

<!-- Template for the first step of the New Scenario submission: Basic info -->
<template name="scenarioFormBasicInfo">
        
    <span style="font-size:12pt;"><b>Guidelines</b></span>
    <ul>
        <li>A brief explanation of an event is enough to describe a scenario. Try to keep information relevant, short and simple. Click o"example" to see an illustrative example on how an actual scenario would complete each field.</li>
        <li>Do not include protected health information. Omit actual names of individuals or institutions.</li>
        <li>Try avoid submitting scenarios redundant to the ones already in the repository.</li>
        <li>Once you have described the risk to patient safety you are welcome, but not required, to enter some additional information by clicking the "Add Further Details" button.</li>
    </ul>  


    {{#if printScenarioMetainfo}}
        <b>Scenario UID:</b> {{_id}} <b>Saved last:</b> {{formatDate createdAt}}<br/>
    {{/if}}

    <label>Title</label>
    {{#if editableScn}} 
        <textarea type="text" id="title" name="title" rows="1" cols="75" placeholder="Type to add a title" >{{title}}</textarea><br/>
    {{else}}
        <textarea type="text" id="title" name="title" rows="1" cols="75" placeholder="Type to add a title" readonly>{{title}}</textarea><br/>
    {{/if}} 
    <label>Description</label><br/>
    <textarea type="text" id="description" name="description" rows="4" cols="100" placeholder="Type to add a description" >{{description}}</textarea><br/>

</template>

<!-- Template for the second step of the New Scenario submission: Advanced info -->
<template name="scenarioFormAdvancedInfo">
    <span style="font-size:12pt;"><b>Additional Information</b></span>
    <p>Step 2 of 3 (optional): Add additional information about the scenario.</p>
    <ul>
        <li>Add further details about contributing actors or events that happened or could happen in this kind of scenario.</li>
        <li>No fields are mandatory. Complete the information in the tabs that you think is relevant for the case and submit when it is ready.</li>
        <li>Tabs can be visited in any order, and not all of them may be needed to be visited in order to accurately describe the scenario.</li>
    </ul>

    {{#if printScenarioMetainfo}}
        <b>Scenario UID:</b> {{_id}} <b>Saved last:</b> {{formatDate createdAt}}<br/>
    {{/if}}

    <div>
        <table>
            <tr>
                <td><button type="button" id="hazardsButton" title="check the Hazards tab">Hazards</button></td>
                <td><button type="button" id="equipmentButton" title="check the Equipment tab">Equipment</button></td>
                <td><button type="button" id="lessonsLearnedButton" title="check the Lessons Learned tab">Lessons Learned</button></td>
                <td><button type="button" id="referencesButton" title="check the References tab">Relevant references</button></td>
            </tr>
        </table>
    </div>
    
    <div class="main">
        {{> Template.dynamic template=advancedDetailsTemplateName}}
    </div>
</template>

<!-- Template for the Third step of the New Scenario submission: Solution -->
<template name="scenarioFormSolution">
    <span style="font-size:12pt;"><b>Share a Good Idea</b></span>
    <p>Step 3 of 3 (optional): Propose a solution for a barrier in patient safety or share a <em>good idea</em>.</p>
    <ul>
        <li>Share a good idea to improve Healthcare, clinical processes or patient safety. </li>
        <li>Describe, in any degree of detail you feel comfortable with, what you think could provide a solution for a barrier in patient safety.</li>        
        <li>Feel welcome to address early any potential new risks in the workflow or systems introduced by the solution.</li>
        <li>Discuss or highlight the benefits of your proposed solution or idea.</li>
    </ul>

    <label><b>Title: </b></label>
    <label>{{title}}</label>
    {{#if printScenarioMetainfo}}
        <b>Scenario UID:</b> {{_id}} <b>Saved last:</b> {{formatDate createdAt}}
    {{/if}}
    <br/>

    <label>Describe Your Good Idea or Solution</label><br/>
    <textarea type="text" id="solutionDescription" rows="1" cols="75" >{{solutionDescription}}</textarea><br/>
    <label>Benefits of the New System</label><br/>
    <textarea type="text" id="benefitsDescription"  rows="1" cols="75" >{{benefitsDescription}}</textarea><br/>
    <label>Foreseen Risks of the New System</label><br/>
    <textarea type="text" id="risksDescription"  rows="1" cols="75" >{{risksDescription}}</textarea><br/>
</template>

<!-- Template for the "Finish and Submit" confirmation and  disclaimer page" -->
<template name="scenarioFormSubmitConfirmation">

<p>You are about to submit your scenario "<em>{{title}}</em>".</p>

<p>By submitting your clinical scenario you:</p>

<ol type="1">
    <li>
    Acknowledge that you are the ultimate resposible for the information contained in the scenario you are submitting and that you have done your best effort to de-identify the information contained in it.
    </li>

    <li>
    Acknowledge that you understand the purporse of this Clinical Scenario Repository and that it does NOT substitute any other medico-legal reporting tools, mechanisms or regulatory paths you may be legally or professionally obliged to abide.
    </li>

    <li>
    Acknowledge that you understand that the information submitted to this repository is being gathered for research purposes, and thus may be shared with individuals or institutions.
    </li>
</ol>

<p><b>
Important: The aim of this repository is NOT to provide any kind of advice (medical, legal or otherwise) or solution about a health issue. If you are suffering from a medical problem you should call your physician. In case of a medical emergency dial 911.
</b></p>

<p>
By clicking the "<em>Submit</em>" button you explicitly affirm that you have read, understood and done your best to comply with the abovementioned statements.
</p>

<input type="checkbox" id="acceptanceCheck" unchecked> 

I understand that I, the scenario submitter, am the ultimate resposible for the information contained in the scenario, and I have done my best to avide the <em>Clinical Scenario Repository's</em> policies. <br>


<div>
    <button type="button" id="declineSubmit" title="Go to the scenario panel panel" >Decline</button> 
    <button type="button" id="acceptSubmit" title="Accept and submit" >Submit</button>
</div>

</template>

<!-- Template to thank the user for his/her contribution and suggest the Feedback survey-->
<template name="scenarioFormThankYou">
    Thank you for you contribution. <br/>

    <p>Your scenario was persited in the <em>Clinical Scenario Repository </em> with the unique identifier: <br/></p>

    <b>{{_id}}</b>

    <p>Please, consider <a href="{{ pathFor 'FeedbackForm' }}">taking a brief survey </a> about your experience using this tool to help imporving this Clinical Scenario Repository.</p>

</template>

<!-- Templates for step 2: advanced details: -->
<!-- ======================================= -->

<!-- Template for step 2: advanced details: Hazards-->
<template name="advancedDetailsHazards" >
    <p>Describe current or possible risks to patient safety</p>

    <table border="1">
        <tr>
            <td>Description</td>
            <td title="Likeness to Predict this Hazard">Predictability</td>
            <td title="Level of Harm to Patient (per AHRQ Scale)">Severity</td>
        </tr>
        <tr>
        
            <td><textarea type="text" id="hazardDescription" rows="3" cols="40" placeholder="Type to add a Description" ></textarea></td>
            <td><select id="hazardRisk">
                <option value="Unknown" autofocus>Unknown</option>
                <option value="Expected">Expected</option>
                <option value="Unexpected">Unexpected</option>
                </select>
            </td>
            <td><select id="hazardSeverity">
                <option value ="Unknown" autofocus>Unknown</option>
                <option value ="Unsafe Condition">Unsafe Condition</option>
                <option value ="Near Miss">Near Miss</option>
                <option value ="No Harm">No Harm</option>
                <option value ="Emotional Distress or Inconvenience">Emotional Distress or Inconvenience</option>
                <option value ="Additional Treatment">Additional Treatment</option>
                <option value ="Temporary Harm">Temporary Harm</option>
                <option value ="Permanent Harm">Permanent Harm</option>
                <option value ="Severe Permanent Harm">Severe Permanent Harm</option>
                <option value ="Death">Death</option>       
            </select>               
            </td>      
        </tr>
    </table>

    <button type="button" id="addNewHazard" >Add Another Hazard Description</button>

    <table border="1">
        <tr>
            <td>Description</td>
            <td>Expected risks</td>
            <td>Severity</td>
        </tr>
        {{#each hazardEntryList}}
            {{> hazardEntry}}
        {{/each}}
    </table>

</template>

<!-- Template ot display the info of a single hazard-->
<template name="hazardEntry">
    <tr>
    <td><label>{{hazardDescription}}</label></td>
    <td><label>{{hazardRisk}}</label></td>
    <td><label>{{hazardSeverity}}</label></td>
    <!--<td><label>{{id}}</label></td>-->
    <td> <button id="deleteHazard">Delete</button></td>
    </tr>   
</template>

<!-- Template for step 2: advanced details: Equipment-->
<template name="advancedDetailsEquipment" >
    This is the <b>Equipment</b> template.

</template>

<!-- Template for step : advanced details: Lessons Learned-->
<template name="advancedDetailsLessonsLearned" >
    <p>What can be learned from this scenario?</p>
    <textarea type="text" id="lesson" rows="4" cols="75" placeholder="Describe what can be learned from this scenario" >{{lessonsLearned}}</textarea><br/>
    Do you think this incident could have been prevented or mitigated through better technology?
    <select id="preventable" value="yes">
        <option value ="notSure" {{selectedLessonLearned "notSure"}}>I am not sure</option>   
        <option value ="yes" {{selectedLessonLearned "yes"}}>Yes</option>   
        <option value ="no" {{selectedLessonLearned "no"}}>No</option>      
    </select>

</template>

<!-- Template for step : advanced details: Relevant References-->
<template name="advancedDetailsReferences">
 <p>Add any relevant online references to this scenario (FDA or Maude reports, articles or white papers, pieces of software and/or other documentation) </p>

 <table>
     <tr>
        <th></th>
        <th>URL of the reference</th>
        <th>Relevance</th>
     </tr>
     <tr>
         <td><select id="referenceUrlProtocol" >
             <option value ="http://">http</option>
             <option value ="https://">https</option>
         </select></td>
         <td><textarea type="text" id="referenceUrl" rows="1" cols="35" placeholder="Type the reference url" ></textarea></td>
         <textarea type="text" id="referenceRelevance" rows="3" cols="40" placeholder="Briefly describe why is important or relevant" ></textarea>
     </tr>

 </table>

 <button type="button" id="addNewReference" >Add Another Reference</button>

 <table border="1">
     <tr>
         <th>URL of the reference</th>
         <th>Relevance</th>
     </tr>
     {{#each referenceEntryList}}
         {{> referenceEntry}}
     {{/each}}
 </table>

</template>

<!-- Template to disply the info of a single reference-->
<template name="referenceEntry">
    <tr>
    <td><a href="{{referenceUrl}}" target="_blank">{{referenceUrl}}</a></td>
    <td><label>{{referenceRelevance}}</label></td>
    <td> <button id="deleteReference">Delete</button></td>
    </tr>   
</template>